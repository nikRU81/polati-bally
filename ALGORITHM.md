# Алгоритм расчёта экономического эффекта

## 1. Расчёт бюджета

### Формула зарплаты по годам

```
ЗП[год] = Базовая_ЗП × (1 + Инфляция)^(год - 1)
```

### Пример (инфляция 15%):

| Год | Расчёт | ЗП/год |
|-----|--------|--------|
| 1 | 1 200 000 × 1.15^0 | 1 200 000 |
| 2 | 1 200 000 × 1.15^1 | 1 380 000 |
| 3 | 1 200 000 × 1.15^2 | 1 587 000 |
| 4 | 1 200 000 × 1.15^3 | 1 825 050 |
| 5 | 1 200 000 × 1.15^4 | 2 098 808 |

### Формула бюджета

```
Бюджет[год] = ЗП[год] × Процент_бюджета / 100
```

---

## 2. Расчёт базовых начислений

### Источники данных

- `tasks.csv` — перечень всех заданий
- `employee_patterns.csv` — агрегированные данные по годам

### Формула агрегации

```
Базовые[год] = Σ (Баллы × Вероятность × Количество)
              для всех заданий, применимых к году
```

### Результат по годам работы

| Год | Базовые баллы |
|-----|---------------|
| 1 | 16 490 |
| 2 | 12 700 |
| 3 | 10 990 |
| 4 | 10 800 |
| 5 | 11 190 |

---

## 3. Индексация ставок

### Условие применения

```
Если Календарный_год > Год_запуска + Период_индексации:
    Индексация = Коэффициент_индексации
Иначе:
    Индексация = 1.00
```

### Формула индексированных баллов

```
Базовые_инд[год] = Округление(Базовые[год] × Индексация, до десятков)
```

### Пример (индексация ×1.50 с 4-го года)

| Год | Базовые | Индекс. | Базовые инд. |
|-----|---------|---------|--------------|
| 1 | 16 490 | ×1.00 | 16 490 |
| 2 | 12 700 | ×1.00 | 12 700 |
| 3 | 10 990 | ×1.00 | 10 990 |
| 4 | 10 800 | ×1.50 | 16 200 |
| 5 | 11 190 | ×1.50 | 16 790 |

---

## 4. Подбор добавок

### Алгоритм

```python
def calculate_allowances(budget, base_indexed, rounding=100):
    cumulative_budget = 0
    cumulative_total = 0
    allowances = []
    
    for year in range(1, N+1):
        cumulative_budget += budget[year]
        
        # Проверяем нужна ли добавка
        projected_total = cumulative_total + base_indexed[year]
        
        if projected_total >= cumulative_budget:
            allowance = 0
        else:
            gap = cumulative_budget - projected_total
            allowance = round_to(gap, rounding)
        
        total = base_indexed[year] + allowance
        cumulative_total += total
        allowances.append(allowance)
    
    return allowances
```

### Ограничение

```
Итого_за_N_лет / Бюджет_за_N_лет <= 1 + Макс_отклонение / 100
```

---

## 5. Проверки

### Проверка 1: Среднее отклонение от бюджета

```
Отклонение = (Сумма_итого / Сумма_бюджетов - 1) × 100

PASS если Отклонение <= +2%
```

### Проверка 2: Нарастающий итог

```
Для каждого года:
    PASS если Накоплено_итого[год] >= Накоплено_бюджет[год]
```

### Проверка 3: Покупательная способность

```
Цена_референса[год] = Базовая_цена × (1 + Инфляция)^(год - 1)

Для каждого года:
    PASS если Итого[год] >= Цена_референса[год]
```

---

## 6. Итоговая таблица

### Структура

| Столбец | Формула |
|---------|---------|
| Год | 1, 2, 3, 4, 5 |
| ЗП/год | Базовая × (1 + инфляция)^(год-1) |
| Бюджет 1% | ЗП × 1% |
| Базовые (до инд.) | Из employee_patterns |
| Индекс. | 1.00 или коэффициент |
| Базовые (после инд.) | Базовые × Индекс. (округл.) |
| Добавка | Из алгоритма подбора |
| **Итого** | Базовые инд. + Добавка |
| Нараст. бюджет | Σ Бюджет[1..год] |
| **Нараст. итого** | Σ Итого[1..год] |
| Нараст. ≥ бюджет? | Нараст. итого - Нараст. бюджет |
| Сумка стоит | Цена × (1 + инфляция)^(год-1) |
| Итого ≥ Сумка? | Итого - Цена сумки |

---

## 7. Пример полного расчёта

### Входные данные

- Базовая ЗП: 1 200 000 ₽
- Инфляция: 15%
- Индексация: ×1.50 с 4-го года
- Референсный товар: Сумка (10 499 ₽)

### Результат

| Год | Бюджет | Базовые | Инд. | Баз. инд. | Добавка | **Итого** | Нар. бюдж. | **Нар. итого** | Проверка |
|-----|--------|---------|------|-----------|---------|-----------|------------|----------------|----------|
| 1 | 12 000 | 16 490 | ×1.00 | 16 490 | 0 | **16 490** | 12 000 | **16 490** | ✅ +4 490 |
| 2 | 13 800 | 12 700 | ×1.00 | 12 700 | 0 | **12 700** | 25 800 | **29 190** | ✅ +3 390 |
| 3 | 15 870 | 10 990 | ×1.00 | 10 990 | 3 900 | **14 890** | 41 670 | **44 080** | ✅ +2 410 |
| 4 | 18 251 | 10 800 | ×1.50 | 16 200 | 1 000 | **17 200** | 59 921 | **61 280** | ✅ +1 359 |
| 5 | 20 988 | 11 190 | ×1.50 | 16 790 | 4 000 | **20 790** | 80 909 | **82 070** | ✅ +1 161 |

### Итоговые проверки

| Проверка | Результат |
|----------|-----------|
| Среднее: 16 414 / 16 182 | **+1,4%** ✅ |
| Нарастающий итог ≥ бюджета | Все 5 лет ✅ |
| Итого ≥ Сумки | Все 5 лет ✅ |
