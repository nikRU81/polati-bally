# Техническое задание: Калькулятор ПОЛАТИ БАЛЛЫ

## 1. Общие сведения

### 1.1 Назначение
Интерактивный калькулятор для моделирования программы лояльности «ПОЛАТИ БАЛЛЫ» с расчётом экономического эффекта и проверкой соответствия бюджетным ограничениям.

### 1.2 Целевая аудитория
- HR-аналитики
- Финансовый отдел
- Руководство компании

### 1.3 Базовые принципы программы
- **Курс балла**: 1 балл = 1 рубль (фиксированный)
- **Бюджет**: 1% от годовой зарплаты сотрудника
- **Баллы не сгорают**: накопление без ограничений

---

## 2. Входные параметры

### 2.1 Глобальные настройки

| Параметр | Тип | По умолчанию | Описание |
|----------|-----|--------------|----------|
| `base_salary` | число | 1 200 000 | Базовая годовая ЗП (руб.) |
| `budget_percent` | число | 1.0 | Процент от ЗП на программу |
| `inflation_rate` | число | 15.0 | Годовая инфляция (%) |
| `indexation_period` | число | 3 | Период индексации (лет) |
| `indexation_coefficient` | число | 1.52 | Коэффициент индексации |
| `simulation_years` | число | 5 | Период моделирования (лет) |
| `max_budget_deviation` | число | 2.0 | Максимальное отклонение от бюджета (%) |

### 2.2 Параметры добавок

| Параметр | Тип | По умолчанию | Описание |
|----------|-----|--------------|----------|
| `allowance_rounding` | число | 100 | Округление добавок (баллов) |
| `allowance_frequency` | строка | "semi-annual" | Частота добавок |

---

## 3. Структура данных

### 3.1 Задания (tasks.csv)

| Поле | Тип | Описание |
|------|-----|----------|
| `task_id` | строка | Уникальный идентификатор |
| `category` | строка | Категория задания |
| `task_name` | строка | Название задания |
| `base_points` | число | Базовое количество баллов |
| `frequency` | строка | Периодичность: once/yearly/conditional |
| `condition` | строка | Условие получения (если есть) |
| `probability` | число | Вероятность выполнения (0-1) |
| `applies_to_year` | строка | Годы применения: 1/2/3/4/5/all |
| `description` | строка | Описание задания |

### 3.2 Каталог товаров (catalog.csv)

| Поле | Тип | Описание |
|------|-----|----------|
| `item_id` | строка | Уникальный идентификатор |
| `item_name` | строка | Название товара |
| `base_price` | число | Базовая цена (баллов) |
| `category` | строка | Категория: anchor/dynamic |
| `is_reference` | булево | Референсный товар для проверок |

### 3.3 Паттерны начислений (employee_patterns.csv)

| Поле | Тип | Описание |
|------|-----|----------|
| `employee_year` | число | Год работы сотрудника (1-5) |
| `category` | строка | Категория начислений |
| `points` | число | Баллы за год |

### 3.4 Настройки (settings.csv)

| Поле | Тип | Описание |
|------|-----|----------|
| `parameter` | строка | Название параметра |
| `value` | число/строка | Значение |
| `description` | строка | Описание |

---

## 4. Алгоритм расчёта

### 4.1 Расчёт бюджета по годам

```
Для каждого года Y (1..N):
    salary[Y] = base_salary × (1 + inflation_rate)^(Y-1)
    budget[Y] = salary[Y] × budget_percent / 100
    cumulative_budget[Y] = сумма(budget[1..Y])
```

### 4.2 Расчёт базовых начислений

```
Для каждого года Y (1..N):
    base_points[Y] = сумма всех заданий, применимых к году Y
    
    Если Y > indexation_period:
        indexation = indexation_coefficient
    Иначе:
        indexation = 1.0
    
    indexed_points[Y] = округление(base_points[Y] × indexation, до десятков)
```

### 4.3 Подбор добавок

```
Для каждого года Y (1..N):
    required = budget[Y] - indexed_points[Y]
    
    Если cumulative_total[Y-1] + indexed_points[Y] >= cumulative_budget[Y]:
        allowance[Y] = 0
    Иначе:
        allowance[Y] = округление(required, allowance_rounding)
    
    total[Y] = indexed_points[Y] + allowance[Y]
    cumulative_total[Y] = cumulative_total[Y-1] + total[Y]
```

### 4.4 Проверки

```
Проверка 1: Среднее отклонение
    avg_budget = среднее(budget[1..N])
    avg_total = среднее(total[1..N])
    deviation = (avg_total / avg_budget - 1) × 100
    PASS если deviation <= max_budget_deviation

Проверка 2: Нарастающий итог
    Для каждого года Y:
        PASS если cumulative_total[Y] >= cumulative_budget[Y]

Проверка 3: Покупательная способность
    Для каждого года Y:
        reference_price[Y] = base_reference_price × (1 + inflation_rate)^(Y-1)
        PASS если total[Y] >= reference_price[Y]
```

---

## 5. Выходные данные

### 5.1 Итоговая таблица

| Столбец | Описание |
|---------|----------|
| Год | Календарный год |
| ЗП/год | Годовая зарплата с инфляцией |
| Бюджет 1% | Целевой бюджет программы |
| Базовые (до инд.) | Базовые начисления до индексации |
| Индекс. | Коэффициент индексации |
| Базовые (после инд.) | Базовые начисления после индексации |
| Добавка | Полугодовая/годовая добавка |
| **Итого** | Всего начислено за год |
| Нараст. бюджет | Накопленный бюджет |
| **Нараст. итого** | Накопленные начисления |
| Нараст. ≥ бюджет? | Проверка нарастающего итога |
| Сумка стоит | Цена референсного товара |
| Итого ≥ Сумка? | Проверка покупательной способности |

### 5.2 Сводка проверок

| Проверка | Формула | Критерий |
|----------|---------|----------|
| Среднее отклонение | avg_total / avg_budget - 1 | ≤ +2% |
| Нарастающий итог | cumulative_total[Y] vs cumulative_budget[Y] | ≥ 0 каждый год |
| Покупательная способность | total[Y] vs reference_price[Y] | ≥ 0 каждый год |

---

## 6. Интерфейс пользователя

### 6.1 Панель настроек

- Ползунки для числовых параметров
- Поля ввода с валидацией
- Кнопка «Сбросить к умолчаниям»

### 6.2 Редактор заданий

- Таблица со всеми заданиями
- Возможность редактирования баллов
- Фильтрация по категориям
- Добавление/удаление заданий

### 6.3 Панель результатов

- Итоговая таблица с проверками
- Индикаторы статуса (✅/❌)
- Графики:
  - Бюджет vs Начисления по годам
  - Нарастающий итог
  - Покупательная способность

### 6.4 Экспорт

- CSV с итоговой таблицей
- PDF-отчёт
- JSON с полными данными

---

## 7. Формулы расчёта

### 7.1 Инфляция зарплаты

```
salary_year_n = base_salary × (1 + inflation_rate / 100) ^ (n - 1)
```

### 7.2 Индексация ставок (округление до десятков)

```
indexed_points = round(base_points × indexation_coefficient, -1)
```

### 7.3 Цена товара с инфляцией

```
price_year_n = base_price × (1 + inflation_rate / 100) ^ (n - 1)
```

### 7.4 Отклонение от бюджета

```
deviation_percent = (sum(total) / sum(budget) - 1) × 100
```

---

## 8. Валидация данных

### 8.1 Обязательные проверки

- `base_salary` > 0
- `budget_percent` ∈ [0.1, 10.0]
- `inflation_rate` ∈ [0, 50]
- `indexation_period` ∈ [1, 10]
- `indexation_coefficient` ∈ [1.0, 3.0]
- `simulation_years` ∈ [1, 10]

### 8.2 Предупреждения

- Если `deviation_percent` > `max_budget_deviation`: требуется корректировка добавок
- Если `cumulative_total` < `cumulative_budget`: требуется увеличение добавок
- Если `total` < `reference_price`: сотрудник не может купить референсный товар

---

## 9. Технические требования

### 9.1 Платформа

- React + TypeScript (предпочтительно)
- Альтернатива: HTML + Tailwind CSS + JavaScript

### 9.2 Зависимости

- Recharts или Chart.js для графиков
- PapaParse для работы с CSV
- jsPDF для экспорта в PDF (опционально)

### 9.3 Совместимость

- Современные браузеры (Chrome, Firefox, Safari, Edge)
- Адаптивный дизайн для планшетов

---

## 10. Приложения

- `data/tasks.csv` — полный перечень заданий
- `data/catalog.csv` — каталог товаров
- `data/settings.csv` — настройки по умолчанию
- `data/employee_patterns.csv` — паттерны начислений
- `examples/calculation_example.csv` — пример расчёта
